{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">All Events</h2>
  <form method="get" class="form-inline">
    <label class="mr-2 small mb-0">Category</label>
    <select name="category" class="form-control form-control-sm mr-2" onchange="this.form.submit()">
      <option value="">All</option>
      {% for cat in categories %}
        <option value="{{ cat.slug }}" {% if selected_category and selected_category.slug == cat.slug %}selected{% endif %}>{{ cat.name }}</option>
      {% endfor %}
    </select>
    {% if selected_category %}
      <a href="?" class="btn btn-link btn-sm">Clear</a>
    {% endif %}
  </form>
</div>
<div class="row">
  {% for event in events %}
  <div class="col-md-4 mb-3">
    <div class="card h-100 card-interactive">
      <div class="card-body d-flex flex-column">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <h5 class="card-title mb-0">{{ event.title }}</h5>
          {% if event.category %}
            <span class="badge badge-pill badge-category">{{ event.category.name }}</span>
          {% endif %}
        </div>
        <p class="card-text">{{ event.description|truncatechars:120 }}</p>
        <div class="mt-auto d-flex">
          <a href="{% url 'event_detail' event.slug %}" class="btn btn-gradient">View Event</a>
          {% if user.is_authenticated and user.is_staff or user.is_authenticated and event.organizer == user or user.is_authenticated and user.is_superuser %}
            <a href="{% url 'edit_event' event.pk %}" class="btn btn-outline-secondary ml-2">Edit</a>
            <a href="{% url 'delete_event' event.pk %}" class="btn btn-outline-danger ml-2">Delete</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<nav>
  <ul class="pagination">
    {% if events.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ events.previous_page_number }}">Previous</a></li>
    {% endif %}
    <li class="page-item disabled"><span class="page-link">Page {{ events.number }} of {{ events.paginator.num_pages }}</span></li>
    {% if events.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ events.next_page_number }}">Next</a></li>
    {% endif %}
  </ul>
</nav>
{% endblock %}